---
title: Данкшардинг
description: Узнайте о прото-данкшардинге и данкшардинге — двух последовательных обновлениях для масштабирования Ethereum.
lang: ru
summaryPoints:
  - Данкшардинг — это многофазовое обновление, нацеленное на улучшение масштабируемости и производительности Ethereum.
  - Первый этап, прото-данкшардинг, добавляет «блобы» данных к блокам.
  - Блобы данных предлагают более дешевый способ размещения данных в Ethereum для свертков. Для пользователей это может означать снижение комиссий на транзакции.
  - Позже полный данкшардинг распространит ответственность за проверку блобов данных на множество узлов, дополнительно масштабируя Ethereum до более чем 100 000 транзакций в секунду.
---

# Данкшардинг {#danksharding}

**Данкшардинг** — это то, как Ethereum становится по-настоящему масштабируемым блокчейном. Но есть несколько улучшений протокола, которые для этого потребуются. **Прото-данкшардинг** — промежуточный шаг на этом пути. Оба стремятся сделать транзакции на уровне 2 как можно дешевле для пользователей и должны масштабировать Ethereum до > 100 000 транзакций в секунду.

## Что такое прото-данкшардинг? {#what-is-protodanksharding}

Прото-данкшардинг ([EIP-4844](https://eips.ethereum.org/EIPS/eip-4844)) — это способ для [свертков](/layer2/#rollups) добавлять данные в блоки дешевле. Название происходит от двух исследователей, которые предложили идею: Protolambda и Dankrad Feist. На данный момент свертки ограничены в том, насколько дешевыми они могут сделать пользовательские транзакции, так как они размещают свои транзакции в `CALLDATA`. Это дорого, потому что они обрабатываются всеми узлами Ethereum и остаются навсегда в цепи, даже несмотря на то, что данные сверткам нужны только в течение короткого времени. Прото-данкшардинг вводит блобы данных, которые могут быть отправлены и прикреплены к блокам. Данные в этих блобах недоступны для EVM и автоматически удаляются спустя определенное время (1–3 месяца). Это означает, что свертки могут отправлять свои данные гораздо дешевле, и эта экономия отразится в форме более дешевых транзакций.

<ExpandableCard title="Почему блобы делают свертки дешевле?" eventCategory="/roadmap/danksharding" eventName="clicked why do blocks make rollups cheaper?">

Свертки являются способом масштабирования Ethereum путем пакетирования транзакций вне цепочки и размещения результатов в Ethereum. Сверток, по сути, состоит из двух частей: данные и проверка выполнения. Эти данные представляют собой полную последовательность транзакций, которые обрабатываются свертком для получения изменений состояния, которые, в свою очередь, публикуются в Ethereum. Проверка выполнения — это повторное выполнение этих транзакций каким-либо честным субъектом («доказывающим»), чтобы гарантировать правильность предлагаемого изменения состояния. Чтобы выполнить проверку выполнения, данные транзакции должны быть доступны достаточно долго, чтобы любой мог скачать и проверить их. Это означает, что любое нечестное поведение секвенсора свертка может быть идентифицировано и оспорено доказывающим. Однако нет необходимости, чтобы они были доступны вечно.

</ExpandableCard>

<ExpandableCard title="Почему в удалении данных из блобов нет проблемы?" eventCategory="/roadmap/danksharding" eventName="clicked why is it OK to delete the blob data?">

Свертки содержат обязательства по данным их транзакций на цепи, а также предоставляют фактические данные в виде блобов данных. Это означает, что доказывающие могут проверять действительность обязательств или оспаривать данные, которые они считают неправильными. На уровне узлов блобы данных хранятся в клиенте консенсуса. Клиенты консенсуса подтверждают, что они видели данные и что они были распространены по сети. Если бы данные хранились вечно, размер этих клиентов раздувался бы, что приводило бы к большим требованиям к оборудованию для работающих узлов. Вместо этого данные автоматически удаляются из узла каждые 1–3 месяца. Подтверждения клиентов консенсуса показывают, что у доказывающих была достаточная возможность проверить данные. Фактические данные могут храниться вне цепочки операторами свертков, пользователями или другими лицами.

</ExpandableCard>

### Как проверяются данные блобов? {#how-are-blobs-verified}

Свертки публикуют транзакции, которые они выполняют в блобах данных. Кроме того, они публикуют «обязательства» в отношении данных. Они делают это, приближая полиномиальную функцию к данным. Затем эту функцию можно оценить в различных точках. Например, если мы определяем чрезвычайно простую функцию `f(x) = 2x – 1`, то сможем оценить эту функцию для `x = 1`, `x = 2`, `x = 3`, получая результат `1, 3, 5`. Доказывающий применяет ту же функцию к данным и оценивает их в тех же точках. Если исходные данные будут изменены, функция не будет идентичной, как и значения оценки в каждой точке. На практике обязательства и доказательства являются более сложными, потому что они упакованы в криптографические функции.

### Что такое KZG? {#what-is-kzg}

KZG — это аббревиатура от Кейт-Заверуча-Голдберг, имен трех [первоначальных авторов](https://link.springer.com/chapter/10.1007/978-3-642-17373-8_11) схемы, которая уменьшает блоб данных до маленького [криптографического «обязательства»](https://dankradfeist.de/ethereum/2020/06/16/kate-polynomial-commitments.html). Блоб данных, представленных в свертке, должен быть проверен, чтобы убедиться, что в нем нет нарушений. Этот процесс включает в себя повторное выполнение доказывающим транзакций в блобе для проверки действительности обязательства. Концептуально это то же самое, что и клиенты-исполнители, проверяющие действительность транзакций Ethereum на уровне 1 с помощью доказательств Меркла. KZG — это альтернативное доказательство, которое соответствует полиномиальному уравнению к данным. Обязательство позволяет оценить значение полинома (многочлена) в некоторых секретных точках данных. Доказывающий помещал бы один и тот же многочлен над данными и оценивал бы его при тех же значениях, проверяя, совпадает ли результат. Это способ проверки данных совместим с техниками нулевого разглашения, используемыми некоторыми свертками, а в последствии — и другими частями протокола Ethereum.

### Что такое церемония KZG? {#what-is-a-kzg-ceremony}

Церемония KZG — это способ для многих людей из сообщества Ethereum создать секретную случайную строку чисел, которая может быть использована для проверки некоторых данных. Очень важно, чтобы эта строка чисел не была известна и никто не мог ее воссоздать. Для обеспечения этого каждый участник церемонии получает строку от предыдущего участника. Затем они создают новые случайные значения (например, позволяя браузеру измерять движение мыши) и смешивают их с предыдущим значением. Потом они отправляют значение следующему участнику и уничтожают свое на локальной машине. Пока хотя бы один из участников церемонии будет делать это честно, окончательное значение будет неизвестно атакующему. Церемония KZG EIP-4844 была открыта для публики, и десятки тысяч людей приняли участие, чтобы добавить свою собственную энтропию. Чтобы эта церемония была сорвана, 100 % участников должны были бы быть активно нечестными. С точки зрения участников нет необходимости доверять другому человеку, если они знают, что сами были честны, и понимают, как обезопасили церемонию (они самостоятельно выполнили требование по наличию хотя бы одного честного участника).

<ExpandableCard title="Для чего используется случайный номер с церемонии KZG?" eventCategory="/roadmap/danksharding" eventName="clicked why is the random number from the KZG ceremony used for?">

Когда сверток публикует информацию в блобе, он обеспечивает «обязательство», которое размещает на цепочке. Это обязательство является результатом оценки многочлена, соответствующего данным в определенных точках. Эти точки определяются случайными числами, сгенерированными на церемонии KZG. Затем доказывающие могут оценить многочлен в тех же точках, чтобы проверить данные. Если они получают те же самые значения, данные правильны.

</ExpandableCard>

<ExpandableCard title="Почему случайные данные KZG должны оставаться в секрете?" eventCategory="/roadmap/danksharding" eventName="clicked why does the KZG random data have to stay secret?">

Если кто-то знает случайные места, используемые для обязательства, ему легко создать новый многочлен, который соответствует этим конкретным точкам (т. е. «коллизию»). Это означает, что он смог бы добавлять или удалять данные из блоба и все равно предоставлять достоверное доказательство. Чтобы предотвратить это, вместо сообщения доказывающим фактических секретных мест им передаются местоположения, завернутые в криптографический «черный ящик», используя эллиптические кривые. Это эффективно перемешивает значения таким образом, что исходные не могут быть получены заново, но с помощью некоторых вычислений доказывающие и подтверждающие все еще смогут оценить многочлены в точках, которые они представляют.

</ExpandableCard>

<InfoBanner isWarning mb={8}>
  Ни данкшардинг, ни прото-данкшардинг не следуют традиционной модели «шардинга», направленной на разделение блокчейна на несколько частей. Цепочки осколков больше не являются частью дорожной карты. Вместо этого данкшардинг использует распределенную выборку данных по блобам для масштабирования Ethereum. Это гораздо проще реализовать. Иногда эту модель называют «шардингом данных».
</InfoBanner>

## Что такое данкшардинг? {#what-is-danksharding}

Данкшардинг — это полная реализация масштабирования свертками, которая началась с прото-данкшардинга. Данкшардинг принесет огромное количество места в Ethereum для свертков, чтобы сбросить их сжатые данные транзакций. Это означает, что Ethereum сможет с легкостью поддерживать сотни отдельных свертков, а миллионы транзакций в секунду станут реальностью.

Это работает путем расширения блобов, прикрепленных к блокам от 1 в прото-данкшардинге до 64 в полном данкшардинге. Остальные необходимые изменения — это все обновления того, как работают клиенты консенсуса, чтобы они могли обрабатывать новые большие блобы. Некоторые из этих изменений уже на дорожной карте для других целей, независимо от данкшардинга. Например, данкшардинг требует реализации разделения предлагающих и строителей. Это обновление, которое разделяет задачи по строительству и предложению блоков между различными валидаторами. Аналогично, выборка доступности данных необходима для данкшардинга, но она также необходима для разработки очень легких клиентов, которые не хранят много исторических данных («клиенты без состояния Ethereum»).

<ExpandableCard title="Почему данкшардинг требует разделения предлагающих и строителей?" eventCategory="/roadmap/danksharding" eventName="clicked why does danksharding require proposer-builder separation?">

Разделение предлагающих и строителей требуется для предотвращения того, чтобы отдельные валидаторы создавали дорогостоящие обязательства и доказательства для 32 Мб данных блоба. Это создаст слишком большую нагрузку для людей, которые участвуют в стейкинге в домашних условиях, и потребует от них инвестиций в более мощное оборудование, что вредит децентрализации. Вместо этого специализированные строители блоков берут на себя ответственность за эту дорогую вычислительную работу. Затем они делают свои блоки доступными для просмотра предлагающим блоков. Предлагающий блока просто выбирает блок, который является наиболее выгодным. Любой может проверить блобы дешево и быстро, то есть любой нормальный валидатор может убедиться, что строители блоков ведут себя честно. Это позволяет обрабатывать крупные блобы, не жертвуя децентрализацией. Недобросовестные строители блоков могут быть просто выброшены из сети и подвергнуться сокращению: другие займут их место, потому что строительство блоков является прибыльным видом деятельности.

</ExpandableCard>

<ExpandableCard title="Почему данкшардинг требует выборки доступности данных?" eventCateogry="/roadmap/danksharding" eventName="clicked why does danksharding require data availability sampling?">

Для быстрой и эффективной проверки данных блоба валидаторам необходима выборка доступности данных. Используя выборку доступности данных, проверяющие могут быть совершенно уверены, что данные блока были доступны и правильно зафиксированы. Каждый валидатор может произвольно взять несколько точек данных и создать доказательство. Это означает, что ни один валидатор не должен проверять весь блоб полностью. Если какие-либо данные отсутствуют, это будет быстро идентифицировано, а блоб будет отклонен.

</ExpandableCard>

### Текущий прогресс {#current-progress}

Полный данкшардинг наступит через несколько лет. Несмотря на это, прото-данкшардинг должен появиться относительно скоро. На момент написания (февраль 2023 г.) церемония KZG по-прежнему остается открытой и уже привлекла более 50 000 участников. [EIP](https://eips.ethereum.org/EIPS/eip-4844) для прото-данкшардинга является зрелым, спецификация согласована, а клиенты реализовали прототипы, которые в настоящее время проходят испытания и готовятся к производству. Следующий шаг заключается в реализации изменений в публичной тестовой сети. Вы можете следить за этим в реальном времени, используя [контрольный список готовности EIP 4844](https://github.com/ethereum/pm/blob/master/Breakout-Room/4844-readiness-checklist.md#client-implementation-status).

### Дополнительная литература {#further-reading}

- [Записки о прото-данкшардинге](https://notes.ethereum.org/@vbuterin/proto_danksharding_faq) — _Виталик Бутерин_
- [Записки Данкрада о данкшардинге](https://notes.ethereum.org/@dankrad/new_sharding)
- [Данкрад, Прото и Виталик Бутерин обсуждают данкшардинг](https://www.youtube.com/watch?v=N5p0TB77flM)
- [Церемония KZG](https://ceremony.ethereum.org/)
- [Речь Карла Бихуйзена на Devcon о настройках с доверием](https://archive.devcon.org/archive/watch/6/the-kzg-ceremony-or-how-i-learnt-to-stop-worrying-and-love-trusted-setups/?tab=YouTube)
- [Подробнее о выборке доступности данных для блобов](https://hackmd.io/@vbuterin/sharding_proposal#ELI5-data-availability-sampling)
- [Данкрад Фейст об обязательствах и доказательствах в KZG](https://youtu.be/8L2C6RDMV9Q)
- [Полиномиальные обязательства KZG](https://dankradfeist.de/ethereum/2020/06/16/kate-polynomial-commitments.html)
